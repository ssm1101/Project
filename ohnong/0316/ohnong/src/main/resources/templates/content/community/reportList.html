<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/layoutMagement}">
  <head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
  <title> oh-nong!</title>
   <meta charset="UTF-8">
   <style>
   .pageInfo_area{
    text-align: center;
    width: 50%;
}
.pagination2{
    list-style: none;
    display: inline-block;
    padding: 0;
    margin-top: 20px;
}

.pagination2 li {
    display: inline;
    text-align: center;
}
/*ìˆ«ì*/ 
.pagination2 a {
    float: left;
    display: block;
    font-size: 14px;
    text-decoration: none;
    padding: 5px 12px;
    color: #96a0ad;
    line-height: 1.5;
}
.pagefirst{
    margin-right: 15px;
}
.pagelast{
    margin-left: 15px;
}
.pagefirst:hover, .pagelast:hover, .arrowright:hover, .arrowleft:hover, .model .num:hover{
    color:#2e9cdf;
}
.pagination2 .move.active{
    cursor: default;
    color: #ffffff;
}
.pagination2 .move:active{
    outline: none;
}
.model .num {
    margin-left: 3px;
    padding: 0;
    width: 30px;
    height: 30px;
    line-height: 30px;
    -moz-border-radius: 100%;
    -webkit-border-redius:100%;
    border-radius: 100%;
}
.model .num.active, .model .num:active{
    background-color: #2e9cdf;
    cursor: pointer;
}
.arrowleft{
    width: 0;
    height: 0;
    border-top: 10px solid transparent;
    border-bottom: 10px solid transparent;
    border-right: 10ox solid blue;
}

 a.active {
 	cursor:default;
 	color:#ffffff; 	
 }

  
  .search_area{
    text-align:center;
  }
  .search_area input{
    height: 30px;
    width: 250px;
  }
  .search_area button{
    height: 30px;
    width: 100px;
  }
   .search_area select{
  	height: 30px;
    width:150px;
  }
 .move:link {color: #2e9cdf; text-decoration: none; }
 .move:visited {color:purple; text-decoration: overline;}
 .move:hover {color:#bbb; text-decoration: underline;}
 
 #report-modal,#report-modal2, #report-modal3{
   position: fixed;
   top: 70%;
  left: 50%;
  transform: translate(-50%, -50%);
 
 
 }
 
 
 .m_head {
	padding: 10px;
	display: flex;
	justify-content: space-between;
	background-color: #2A3F54;
	border-top-left-radius: 10px;
	border-top-right-radius: 10px;
	color: white;
}

.m_body {
	max-height: calc(400px);
    overflow-y: auto;
	padding: 20px;
	background-color: #F4F4F4;
}

.m_footer {
	height: 5%;
	padding: 10px;
	background-color: #2A3F54;
	border-bottom-left-radius: 10px;
	border-bottom-right-radius: 10px;
	display: flex;
	justify-content: end;
}

.modal_title {
	font-size: 18px;
	color: gray;
	font-weight: 500;
}

.modal_label {
	padding: 2px 0px 2px 0px;
	background-color: skyblue;
	width: 80px;
	border-top: 2px solid black;
	border-bottom: 2px solid black;
	text-align: center;
	color: black;
	margin-top: 10px;
	font-weight: bolder;
}
 
 
 
 
 
.modal-body{
    max-height: calc(400px);
    overflow-y: auto;
}
 
.x_content{
	 width:100%; 
	 text-align:center; 
	 line-height:31px;
 }
.modal-content{
	border: none;
}
</style>
	</head>  
    <!-- page content -->
        
 <div layout:fragment="contentMagement">
		        <!-- page content -->
<div class="right_col" role="main">
   <div class="">
      <div class="page-title">
         <div class="title_left">
            <h3>Oh! Nong</h3>
              </div>
      </div>
      <div class="clearfix"></div>
      <div class="row" style="display: block;">
      <div class="col-md-12">
         <div class="x_panel">
            <div class="x_title">
                   <h2> ì»¤ë®¤ë‹ˆí‹°  <small style="font-weight: bold;">ì‹ ê³ ë°›ì€ ê¸€</small></h2>
		                  <ul class="nav navbar-right panel_toolbox">
		                     <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
		                     <li class="dropdown">
		                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
		                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
		                           <a class="dropdown-item" href="#">ê³µì§€ì‚¬í•­</a> 
		                           <a class="dropdown-item" href="#">ì˜¤ë†ì‹</a>
		                           <a class="dropdown-item" href="#">ì˜¤ì‹œëŠ”ê¸¸</a>
		                        </div>
		                     </li>
		                  </ul>
		               <div class="clearfix"></div>
		            </div>
		            <div class="x_content">
		            <p style="text-align:left;">ï¼Š ì „ì²´ <span th:text=${pageMaker.total}></span> ê±´ | í˜„ì¬í˜ì´ì§€ [[${pageMaker.criteria.pageNum}]]</p>
		           <div style=" align-items:center; height: 50px; margin-top: 10px;">
				 	 <!-- ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë¥˜ -->
				  <div style=" margin-right:10px; height: 50px; float: left;">
				    <select id="Category" name="type" th:onchange="categoryBoxChange(this.value)" class="btn btn-success dropdown-toggle" style="font-weight: bold; background-color:#2A3F54;border: none; " >
				      <option value="" th:selected="${pageMaker.criteria.category == null?true:false }" >ì „ì²´ì¹´í…Œê³ ë¦¬</option>
				      <option value="A" th:selected="${pageMaker.criteria.category eq 'A'?true:false }">ë…¸í•˜ìš° & íŒ</option>
				      <option value="B" th:selected="${pageMaker.criteria.category eq 'B'?true:false }">1:1ë¬¸ì˜</option>
				      <option value="C" th:selected="${pageMaker.criteria.category eq 'C'?true:false }">ì „ë¬¸ì¸ì—ê²Œ ë¬¼ì–´ë´</option>
				      <option value="D" th:selected="${pageMaker.criteria.category eq 'D'?true:false }">ì¡ë‹´</option>
				    </select>
				  </div>
					</div>
				   <form id="moveFormCategory" method="get" style="display:none;">
		                  <input type="text" name="pageNum" th:value="${pageMaker.criteria.pageNum }">
		                    <input type="text" name="amount" th:value="${pageMaker.criteria.amount }">
		                    <input type="text" name="category" th:value="${pageMaker.criteria.category }"> 
                  </form> 
            
				<!-- ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë¥˜ë --> 
		</div>
                <div class="clearfix"></div>
                <div class="table-responsive" style="height: 700px">
                    <table id="datatable-buttons" class="table table-striped jambo_table bulk_action">
                    <colgroup>
                     <col style="width: 5%;" />
                     <col style="width: 10%;" />
                     <col style="width: 10%;"/>
                     <col style="width: 10%;" />
                     <col style="width: 10%;" />
                     <col style="width: 5%;" />
                     <col style="width: 5%;" />
                     <col style="width: 5%;" />
                     <col style="width: 5%;" />
                  </colgroup>
                      <thead>
                        <tr>
                          <th  class="column-title">No.</th>
                          <th class="column-title">ì¹´í…Œê³ ë¦¬</th>
                          <th class="column-title">ì œëª©</th>
                          <th class="column-title">ì‘ì„±ì</th>
                          <th class="column-title">ë“±ë¡ì¼</th>
                          <th class="column-title">ì¡°íšŒìˆ˜</th>
                          <th class="column-title" >ì‹ ê³  ìˆ˜</th>
                          <th class="column-title">ì‹ ê³ ë‚´ìš©</th>
                          <th class="column-title">ë¸”ë¼ì¸ë“œ</th>
                        </tr>
                      </thead>
                      <tbody>
                         <tr th:each="boardInfo : ${reportBoard}">
                				<td th:text="${boardInfo.boardBno}"/>
                				<td th:switch="${boardInfo.boardCategory}">
                					<span th:case="A">ë…¸í•˜ìš°&íŒ</span>
                					<span th:case="B">1:1ë¬¸ì˜</span>
                					<span th:case="C">ì „ë¬¸ì¸ì—ê²Œ </span>
                					<span th:case="D">ì¡ë‹´</span>
                					 
                				</td>
                				<td> <!--ë¹„ë°€ê¸€+ ë¡œê·¸ì¸ + ì‘ì„±ì. -->
	                				<a th:if="${boardInfo.noshow==1} AND ${session.login !=null} AND (${session.login.userId} == ${boardInfo.userId})"  th:href="@{/communityView(boardBno=${boardInfo.boardBno},userId=${session.login?.userId}),col=F}" th:text="'(ë¹„ë°€ê¸€)'+${boardInfo.boardTitle}"></a>
	                				<a th:unless="${boardInfo.noshow==1} AND ${session.login !=null} AND (${session.login.userId} == ${boardInfo.userId})"  th:href="@{/communityView(boardBno=${boardInfo.boardBno},userId=${session.login?.userId},col=F)}" th:text="${boardInfo.boardTitle}"></a>
                				<td th:text="${boardInfo.userId}"/>
                				<td th:text="${#dates.format(boardInfo.boardRegdate,'yyyy-MM-dd')}"/> 
                				<td th:text="${boardInfo.boardHitcount}"/>
                				<td th:text="${boardInfo.reportCount}+'íšŒ'"/>
                				<!-- ì‹ ê³ ê¸€ëª©ë¡ -->
                				<td><button  th:onclick="reportList([[${boardInfo.boardBno}]])" class="btn btn-secondary btn-sm" >ëª©ë¡</button></td>
                				<!-- ë¸”ë¼ì¸ë“œìœ ë¬´ -->
                				<td><button th:if="${boardInfo.exist==0}" th:onclick="blindBoard([[${boardInfo.boardBno}]])"  class="btn btn-info btn-sm">ë¸”ë¼ì¸ë“œ</button>
                					<button th:if="${boardInfo.exist==5}" th:onclick="boardRestore([[${boardInfo.boardBno}]])" style="background-color:#2A3F54; border:none;"class="btn btn-info btn-sm">ë³µêµ¬</button></td>
                				
                				<!--ì‹ ê³ ê¸€ ëª¨ë‹¬ì°½ -->
											<div class="modal-wrapper">
												<div class="modal" style="width: 700px;" id="report-modal">
													
													<div class="m_head" style="fond-weight:bold;">
														<h2 class="modal-title" id="myModalLabel2"  style="color: white; padding-left:20px; ">ğŸš¨ì‹ ê³ ê¸€ ëª©ë¡</h2>
														<button type="button" class="close" data-dismiss="modal"
																aria-label="Close">
																<span class="close2" aria-hidden="true" style=" color: white; display:right;">X</span>
															</button>
														</div>
														<div class="m_body">
															<!-- ëª©ë¡ -->
															<div id="viewTable"></div>
														</div>
														<div class="m_footer">
														</div>	
														</div>
													</div>
											

											<!-- ë¸”ë¼ì¸ë“œ ëª¨ë‹¬ì°½ -->
	                		<div class="modal-wrapper2">        
								<div class="modal" style="width:500px;border:none; font-weight:700;" id="report-modal2">
									<div class="modal-content">
		
										<div class="m_head">
											<button type="button" class="close" style="margin-left: 450px;">
												<span class="close2" aria-hidden="true" style="color:white;">X</span>
											</button>
										</div>
										<div class="m_body" style="background-color:white">
										<h4 class="modal-title" id="myModalLabel2">
											ì´ ê¸€ì„ ë¸”ë¼ì¸ë“œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h4>
										</div>
										<div class="m_footer">
											<button type="button" class="btn btn-secondary" 
												id="cancleBtn"
												data-dismiss="modal">ì·¨ì†Œ</button>
											<button type="button" id="blindBtn" class="btn btn-primary" style="background-color: #17a2b8; border:none;"
											>ë¸”ë¼ì¸ë“œ</button>
										</div>
									</div>
								</div>
							</div>
							
							<div class="modal-wrapper3">        
								<div class="modal" style="width:500px;border:none; font-weight:700;" id="report-modal3">
									<div class="modal-content">
		
										<div class="m_head">
											<button type="button" class="close" style="margin-left: 450px;">
												<span class="close2" aria-hidden="true" style="color:white;">X</span>
											</button>
										</div>
											<div class="m_body" style="background-color:white">
										<h4 class="modal-title" id="myModalLabel2">
											ì´ ë¸”ë¼ì¸ë“œ ê¸€ì„ ë³µêµ¬ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h4>
										</div>
										
										<div class="m_footer">
											<button type="button" class="btn btn-secondary" 
												id="cancleBtn2"
												data-dismiss="modal">ì·¨ì†Œ</button>
											<button type="button" id="restoreBtn" class="btn btn-primary" style="background-color: #17a2b8; border:none;"
											>ë³µêµ¬</button>
										</div>
									</div>
								</div>
							</div>
							
							</tr>
            			</tbody>
                  	 </table> 
				
				   <div class="pageInfo_area" style="width:100%; text-align: center; disiplay:inline-block; margin-top: 50px;"> 
				<ul class="pagination2 model" th:each="page:${pageMaker}">
					<th:block
						th:with="start = ${page.startPage}, end = ${page.endPage} ">
						<!-- ì²˜ìŒ-->
						<li class="pageInfo_btn"><a class="pagefirst" 
							th:href="@{/reportList?pageNum={page}&amount=10(page = ${1})}" 
							th:text="'<<'"></a></li>
						<!-- ì´ì „ -->
						<li class="pageInfo_btn" th:if="${page.prev}"><a
							class="allowleft"
							th:href="@{/reportList?pageNum={page}&amount=10 (page = ${page.startPage-1})}"
							th:text="'<'"></a></li>
						<!-- ìˆ«ì -->
						<li class="pageInfo_btn"
							th:with="start = ${page.startPage}, end = ${page.endPage} "
							th:each="pageButton : ${#numbers.sequence(start, end)}">
							<a class="num"
							th:href="@{/reportList?pageNum={page}&amount=10(page = ${pageButton})}"
							th:text=${pageButton}
							th:classappend="${pageMaker.criteria.pageNum == pageButton ? 'active':'' }"></a>
						</li>
						<!-- ë‹¤ìŒ -->
						<li class="pageInfo_btn" th:if="${page.next}"><a
							class="arrowright"
							th:href="@{/reportList?pageNum={page}&amount=10(page = ${page.endPage+1})}"
							th:text="'>'"></a></li>
						<!-- ë -->
						<li class="pageInfo_btn"><a class="pagelast"
							th:href="@{/reportList?pageNum={page}&amount=10(page = ${page.realEnd})}"
							th:text="'>>'"> <span>ë</span></a></li>
					</th:block>
					</ul>
					</div>
					</div >
					</div>
				  </div>
              	</div>	
              	 <!-- í˜ì´ì§• -->
              </div>
             </div>                 
<script>

		var msg = "[[${msg}]]";
	
		if(msg != ''){
			 Swal.fire({
	                icon: 'warning',
	                title: msg
	            });
		}



		// ëª¨ë‹¬ì°½ 	ì™¸ë¶€ í´ë¦­ ì‹œ ëª¨ë‹¬ì°½ ë‹«ê¸°
		  $(window).on('click', function(event) {
		    if (event.target == $('#report-modal')[0]) {
		      $('#report-modal').css('display', 'none');
		    }
		  });
		
		  $('.modal-wrapper').on('click', function(event) {
			  $('#report-modal').css('display', 'none');
			});
		  
		  
		  // ëª¨ë‹¬ì°½ ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		  $('.close').on('click', function() {
		    $('#report-modal').css('display', 'none');
		    $('#report-modal2').css('display', 'none');
		    $('#report-modal3').css('display', 'none');
		  });
		  
		  $('#cancleBtn').on('click',function(){
			  $('#report-modal2').css('display', 'none');
		  })
		  
		  $('#cancleBtn2').on('click',function(){
			  $('#report-modal3').css('display', 'none');
		  })
		  		  

			//ë¹„ë°€ê¸€ ì§ì ‘ì ‘ê·¼ë°©ì§€ alertë©”ì„¸ì§€.
			var msg = "[[${msg}]]";
			
			if(msg != ''){
				Swal.fire({
	                icon: 'warning',
	                title: msg
	            });
			}
			
        	//ì¹´í…Œê³ ë¦¬ë³„ ë¶„ë¥˜
           	var categoryBoxChange= function(){
        		
        		
        		let category =$("#Category  option:selected").val();
        		
        		let moveFormCategory = $("#moveFormCategory");
        		
         		console.log(category);	
        		moveFormCategory.find("input[name='category']").val(category);
        		moveFormCategory.find("input[name='pageNum']").val(1);
        		moveFormCategory.submit();
        		}
        	
        	
        	//ì‹ ê³ ëª©ë¡ ë³´ê¸°.
        	function reportList(boardBno){
        		
        		$("#viewTable").empty();
        		
        		$('#report-modal').css('display', 'block');
        		
        		
        		fetch("/ohnong/reportList/" + boardBno,
        			{method: "post"})
				.then(resolve => resolve.json())
				.then(result => {
					let table='';
					table+=`<div><table class="table table-striped jambo_table bulk_action" style="table-layout:fixed;">`;
					table +=`<thead>
							<tr class="headings">
								<th width="50"><input type="checkbox" id="check-all" class="flat"></th>
								<th width="70" style="color:red;" class="column-title">ì‹ ê³ ìœ í˜•</th>
								<th width="200" class="column-title">ì‹ ê³ ë‚´ìš©</th>
								<th width="100" class="column-title">ì‹ ê³ ìœ ì €id</th>
								<th width="98"  class="column-title">ì‹ ê³ ë‚ ì§œ</th>
							</tr>
						</thead>`;
					table += `<tbody>`;
					for(let i=0; i< result.length ; i++){
						table += `<tr class="even pointer">
										<td ><input type="checkbox" class="flat"name="table_records"></td>
										<td >` + result[i].reportType + `</td>
										<td >` + result[i].reportContent + `</td>
										<td>` + result[i].userId + `</td>
										<td>` + result[i].reportDate + `</td>
									</tr>`;
					}
					table += `</tbody></table></div>`;
					$("#viewTable").append(table);
					
				})
        				
        	};
        	
        	
        	//ë¸”ë¼ì¸ë“œì²˜ë¦¬
        	function blindBoard(boardBno){
        		
				$('#report-modal2').css('display', 'block');
        		
				$('#blindBtn').on('click',function(){
					

					 $.ajax({
						 
						 url: "/ohnong/boardBlind",
						 data:{
							 "boardBno" : boardBno
						 },
						 type:"post",
						 success:function(result){
							 
								 if(result ==1){
								
							     $('#report-modal2').css('display', 'none');
								 
								 location.reload()
								 
							 }else{
								 
								 Swal.fire({
						                icon: 'warning',
						                title: "ë¸”ë¼ì¸ë“œ ì‹¤íŒ¨ì…ë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”."
						            });
								 
							 } 	
							 
						 },
						 error:function(){
							 
							 Swal.fire({
					                icon: 'warning',
					                title: "ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
					            });
							
						 }
					
					 })
					
					
					
				});//blindBtnë
			}
        	
        	
        	//ë¸”ë¼ì¸ë“œê¸€ ë³µêµ¬
        	function boardRestore(boardBno){
        		
				$('#report-modal3').css('display', 'block');
        		
				$('#restoreBtn').on('click',function(){
					

					 $.ajax({
						 
						 url: "/ohnong/boardRestore",
						 data:{
							 "boardBno" : boardBno
						 },
						 type:"post",
						 success:function(result){
							 
							 if(result ==1){
								
								
							 	$('#report-modal3').css('display', 'none');
							 
								 location.reload();
							 }else{
								 
								 Swal.fire({
						                icon: 'warning',
						                title: "ë¸”ë¼ì¸ë“œê¸€ ë³µêµ¬ ì‹¤íŒ¨ì…ë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”."
						            });
								
							 } 	
							 
						 },
						 error:function(){
							 
							 Swal.fire({
					                icon: 'warning',
					                title: "ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
					            });
						 }
					
					 })
					
					
					
				});//blindBtnë
			}

        	      
</script>
                                    
                 
                
                   </div>
                </div>
              <!-- í˜ì´ì§• -->                    
 
           <!-- content div ë -->
             
        <!-- /page content -->	
  </body>

</html>