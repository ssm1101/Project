<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/layoutMagement}">

<head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
  <meta charset="UTF-8">
  <style type="text/css">
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    /* Firefox  */
    input[type='number'] {
      -moz-appearance: textfield;
    }

    .left-box {
      float: left;
      width: 50%;
    }

    .right-box {
      float: right;
      width: 50%;
    }

    .form-group {
      width: 350px !important;
    }
 
    .form-control{
      font-size: 13px;
	  color: #222222;
	  width: 320px;
	  border: none;
	  border-bottom: solid #aaaaaa 1px;
	  padding-left: 10px;
	  position: relative;
	  background: none;
	  z-index: 5;
     }
     
    .table-td {
      font-weight:bold;
    }
  </style>
</head>
</th:block>
<th:block layout:fragment="script">
</th:block>
<div layout:fragment="contentMagement">
  <!-- page content -->
  <div class="right_col" role="main">
    <div class="">
      <div class="page-title">
        <div class="title_left">
        </div>

      </div>

      <div class="clearfix"></div>

      <div class="row" style="display: block;">

        <div class="clearfix"></div>

        <div class="col-md-12 col-sm-12  ">
        <h3 style="text-align:left"><b>â€ğŸŒ¾ ì‘ë¬¼ ê´€ë¦¬</b></h3>
          <div class="x_panel">
            <div class="x_title">
              <ul class="nav navbar-right panel_toolbox">
                <button type="button" id="button" class="btn btn-primary antosubmit" style="float:right; padding: 8px 20px;background-color:#2A3F54;border: none;"><b>ë“±ë¡</b></button>
              </ul>
              <div class="clearfix"></div>
            </div>

            <div class="x_content">
              <div class="table-responsive">
                <table class="table table-striped jambo_table bulk_action">
                  <thead>
                    <tr class="headings">
                      <th>
                        <input type="checkbox" id="check-all" class="flat">
                      </th>
                      <th class="column-title">No. </th>
                      <th class="column-title">ì¤‘ë¶„ë¥˜ </th>
                      <th class="column-title">ì‘ë¬¼ ì´ë¦„ </th>
                      <th class="column-title">ë“±ë¡ì¼ì </th>
                      <th class="bulk-actions" colspan="7">
                        <a class="antoo" style="color:#fff; font-weight:500;">Bulk Actions ( <span class="action-cnt">
                          </span> ) <i class="fa fa-chevron-down"></i></a>
                      </th>
                    </tr>
                  </thead>

                  <tbody class="crop">
                    <tr class="even pointer" th:each="cropList : ${cropList }" th:onclick="updateForm()">
                      <td class="a-center ">
                        <input type="checkbox" class="flat" name="table_records">
                      </td>
                      
                      <td class="table-td " th:text="${cropList.rn}"></td>
                      <td class="table-td " th:text="${cropList.middlecatagori}"></td>
                      <td class="table-td " th:text="${cropList.name}"></td>
                      <td class="table-td " th:text="${#dates.format(cropList.registDate,'yyyy-MM-dd')}"></td>
					  
					  <td th:text="${cropList.userId}" style="display:none"/>
                      <td th:text="${cropList.cropNo}" style="display:none"/>
                      <td th:text="${cropList.itemCode}" style="display:none"/>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- /page content -->
  <!-- insert modal 1 -->
  <div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
    <div class="modal-dialog modal-lg"style="width:600px;">
      <form name="form1" th:role="form" th:action="@{cropInfoList}" method="POST">
      <div class="modal-content" style="border: none;">
        <div class="modal-header" style="display: flex; align-items: center; justify-content: space-between; width:100%;height:50px; background-color: #2A3F54;">
          <h5 class="modal-title" id="myModalLabel" style="color:white; font-weight: bold;">ğŸŒ¾ ì‘ë¬¼ ìˆ˜ì •</h5>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"style="color:white;">Ã—</button>
        </div>
        <div class="modal-body">
        	<input class="form-control" type="hidden" name="userId" value="" />
          	<input class="form-control" type="hidden" name="itemCode" value="" />
          	<input class="form-control" type="hidden" name="cropNo" value="" />
          	<div style="float:left; margin-right: 100px;" >
          	  <label style="color:black; margin-left: 5px; font-size: 14px; font-weight: bold;">ì‘ë¬¼ ì´ë¦„</label>
              <input class="form-control" name="name" id="name" value="" placeholder="ì‘ë¬¼ ì´ë¦„" style="width: 200px;">
            </div>
            <div>
          	  <label style="color:black; margin-left: 5px; font-size: 14px; font-weight: bold;">ë“±ë¡ì¼ì</label>
              <input class="form-control" id="registDate" value="" placeholder="ë“±ë¡ì¼ì" style="width: 200px;" readonly>
            </div>
            <div class="form-group" style="margin-top:10px;">
              <label style="color:black; margin-left: 5px; font-size: 14px; font-weight: bold;">ì‘ë¬¼ ì¤‘ë¶„ë¥˜</label>
              <br>
              <input class="form-control" id="middlecatagori" name="middlecatagori" value="" style="display:none;">
              <select id="flag" th:onchange="changeSelect()" style="margin-left: 5px; border-radius: 4px;">
                <option value="">ğŸŒ¾ ë¶„ë¥˜ ì„ íƒ</option>
                <option th:value="ê³¡ë¥˜" >ê³¡ë¥˜</option>
                <option th:value="ì½©ë¥˜" >ì½©ë¥˜</option>
                <option th:value="êµ¬ê·¼ë¥˜" >êµ¬ê·¼ë¥˜</option>
                <option th:value="ì±„ì†Œë¥˜" >ì±„ì†Œë¥˜</option>
                <option th:value="ê³¼ì‹¤ë¥˜" >ê³¼ì‹¤ë¥˜</option>
                <option th:value="ì¢…ì‹¤ë¥˜" >ì¢…ì‹¤ë¥˜</option>
                <option th:value="ë²„ì„¯ë¥˜" >ë²„ì„¯ë¥˜</option>
              </select>
            </div>
        </div>
        <div class="modal-footer" style="display: flex; align-items: center; justify-content: flex-end; width:100%;height:50px; background-color: #2A3F54;">
          <button id="modalModBtn" type="button" class="btn btn-warning" style="border: none; font-weight: bold; color:white; background: #035785; height: 30px;">ìˆ˜ ì •</button>
          <button id="modalRemoveBtn" type="button" class="btn btn-danger" style="border: none; font-weight: bold; color:white; background: #035785; height: 30px;">ì‚­ ì œ</button>
        </div>
      </div>
    </form>
    </div>
  </div>
  <!-- /insert modal -->
  <!-- insert modal 2 -->
  <div id="myModal2" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
    <div class="modal-dialog modal-lg" style="width:600px;">
      <form name="form2" th:role="form" th:action="@{cropInfoAdd}" method="POST">
      <div class="modal-content" style="border: none;">
        <div class="modal-header" style="display: flex; align-items: center; justify-content: space-between; width:100%;height:50px; background-color: #2A3F54;">
          <h5 class="modal-title" id="myModalLabel" style="color:white; font-weight: bold;">ğŸŒ¾ ì‘ë¬¼ ë“±ë¡</h5>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"style="color:white;">Ã—</button>
        </div>
        <div class="modal-body">
          <input type="hidden" class="form-control" name="userId" id="userId" th:value="${session.login.userId}" />
            <div style="float:left; margin-right: 100px;" >
              <label style="font-weight: bold"><span style="color:red; font-size: 15px;">âœ”</span><span style="color:black; margin-left: 5px; font-size: 14px;">ì‘ë¬¼ ì¤‘ë¶„ë¥˜</span></label>
          	  <br>
              <select id="flag2" name="middlecatagori" style="margin-left: 5px; border-radius: 4px; width: 200px;">
                <option value="">ğŸŒ¾ ë¶„ë¥˜ ì„ íƒ</option>
                <option th:value="ê³¡ë¥˜" >ê³¡ë¥˜</option>
                <option th:value="ì½©ë¥˜" >ì½©ë¥˜</option>
                <option th:value="êµ¬ê·¼ë¥˜" >êµ¬ê·¼ë¥˜</option>
                <option th:value="ì±„ì†Œë¥˜" >ì±„ì†Œë¥˜</option>
                <option th:value="ê³¼ì‹¤ë¥˜" >ê³¼ì‹¤ë¥˜</option>
                <option th:value="ì¢…ì‹¤ë¥˜" >ì¢…ì‹¤ë¥˜</option>
                <option th:value="ë²„ì„¯ë¥˜" >ë²„ì„¯ë¥˜</option>
              </select>
            </div>
            <div>
				<label style="font-weight: bold"><span style="color:red; font-size: 15px;">âœ”</span><span style="color:black; margin-left: 5px; font-size: 14px;">ì‘ë¬¼ ì´ë¦„</span></label>
				<input class="form-control" name="name" id="name2" value="" placeholder="ì‘ë¬¼ ì´ë¦„" style="width: 200px;">
            </div>
        </div>
        <div class="modal-footer" style="display: flex; align-items: center; justify-content: flex-end; width:100%;height:50px; background-color: #2A3F54;">
          <button id="modalAddBtn" type="button" class="btn btn-warning" style="border: none; font-weight: bold; color:white; background: #035785; height: 30px;">ë“± ë¡</button>
        </div>
      </div>
    </form>
    </div>
  </div>
  <!-- /insert modal -->

  <script>
  $(document).ready(function(){
	  var modal = $("#myModal");

      // ì…ë ¥ê°’ ì²˜ë¦¬
      var modalMiddlecatagori = modal.find('input[name="middlecatagori"]');
      var modalName = modal.find('input[name="name"]');
	  var modalUserId = modal.find('input[name="userId"]');
	  var modalCropNo = modal.find('input[name="cropNo"]'); // ì‚­ì œìš©(ì—…ë°ì´íŠ¸)
	  var modalItemCode = modal.find('input[name="itemCode"]');
	  var modalRegistDate = modal.find('#registDate');
      
   	  // ë²„íŠ¼ ì²˜ë¦¬
      var modalModBtn = $("#modalModBtn");
      var modalRemoveBtn = $("#modalRemoveBtn");
      var modalAddBtn = $("#modalAddBtn");
      
      // í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì²˜ë¦¬
      $('.crop').on('click', 'tr', function (e) {
    	console.log($(this)[0]);
    	let tr = $(this)[0];
    	
    	modalMiddlecatagori.val($(this)[0].children[2].textContent);
    	modalName.val($(this)[0].children[3].textContent);
    	modalRegistDate.val($(this)[0].children[4].textContent);
    	modalUserId.val($(this)[0].children[5].textContent);
    	modalCropNo.val($(this)[0].children[6].textContent); // ì‚­ì œìš©(ì—…ë°ì´íŠ¸)
    	modalItemCode.val($(this)[0].children[7].textContent);
    	
        if ($(this)[0].children[2].textContent == 'ê³¡ë¥˜') {
        	$("#flag").val("ê³¡ë¥˜").prop("selected", true);
        } else if ($(this)[0].children[2].textContent == 'ì½©ë¥˜') {
        	$("#flag").val("ì½©ë¥˜").prop("selected", true);
        } else if ($(this)[0].children[2].textContent == 'êµ¬ê·¼ë¥˜') {
        	$("#flag").val("êµ¬ê·¼ë¥˜").prop("selected", true);
        } else if ($(this)[0].children[2].textContent == 'ì±„ì†Œë¥˜') {
        	$("#flag").val("ì±„ì†Œë¥˜").prop("selected", true);
        } else if ($(this)[0].children[2].textContent == 'ê³¼ì‹¤ë¥˜') {
        	$("#flag").val("ê³¼ì‹¤ë¥˜").prop("selected", true);
        } else if ($(this)[0].children[2].textContent == 'ì¢…ì‹¤ë¥˜') {
        	$("#flag").val("ì¢…ì‹¤ë¥˜").prop("selected", true);
        } else if ($(this)[0].children[2].textContent == 'ë²„ì„¯ë¥˜') {
        	$("#flag").val("ë²„ì„¯ë¥˜").prop("selected", true);
        }
		
		// ì‚­ì œ ë²„íŠ¼
		modalRemoveBtn.on('click', function() {
			let cropNo = modalCropNo.val();
			console.log(cropNo);
            
			Swal.fire({
	               title: 'ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
	               text: "ë‹¤ì‹œ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹ ì¤‘í•˜ì„¸ìš”.",
	               icon: 'warning',
	               showCancelButton: true,
	               confirmButtonColor: '#3085d6',
	               cancelButtonColor: '#d33',
	               confirmButtonText: 'ì‚­ì œ',
	               cancelButtonText: 'ì·¨ì†Œ'
	           }).then((result) => {
	               if (result.isConfirmed) {
	                   
	                   $.ajax({
	                       type : 'get',
	                       url : "/ohnong/cropInfoDelete/" + cropNo,
	                       dataType : 'text',
	                       success : function(data) {
	                           console.log(data);
	                           if(data == 'success') {
	                           const Toast = Swal.mixin({
	                               toast: true,
	                               position: 'center-center',
	                               showConfirmButton: false,
	                               timer: 2000,
	                               timerProgressBar: true,
	                               didOpen: (toast) => {
	                                 toast.addEventListener('mouseenter', Swal.stopTimer)
	                                 toast.addEventListener('mouseleave', Swal.resumeTimer)
	                               }
	                             })
	                             Toast.fire({
	                               icon: 'success',
	                               title: 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'
	                             })
	                           } else if(data = 'fail') {
	                               alert("ë‹¤ì‹œ ì‹œë„ ë°”ëë‹ˆë‹¤.")
	                           }
	                       },
	                       error : function(status, error) {
	                           console.log(status, error);
	                       }
	                   })
	                   
	                   setTimeout("location.reload()", 2000);
	                   Swal.fire(
	                       'ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',
	                       'success'
	                   )
	               }
	           })
        }) // ì‚­ì œ ë
        
      })
      
      // ë“±ë¡ ë²„íŠ¼
      modalAddBtn.on('click', function() {
    	  var name = $('#name2').val();
    	  var userId = $('#userId').val();
    	  
    	  if($('#name2').val() == '' || $('#flag2').val() == '') {
    		  const Toast = Swal.mixin({
                  toast: true,
                  position: 'center-center',
                  showConfirmButton: false,
                  timer: 2000,
                  timerProgressBar: true,
                  didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                  }
                })

                Toast.fire({
                  icon: 'info',
                  title: 'ì…ë ¥ê°’ì„ ëª¨ë‘ ì ì–´ì£¼ì„¸ìš”.'
                })

              return false;
      }
    	  
      		// ì¤‘ë³µ ê²€ì‚¬
	    	  $.ajax({
	    	        type : 'get',
	    	        url : '/ohnong/checkCrop', // ì„œë²„ ìš”ì²­ url
	    	        dataType : 'text', // ì„œë²„ë¡œë¶€í„° ì‘ë‹µë°›ì„ ë°ì´í„° í˜•íƒœ 
	    	        data : {"name" : name,
	    	        		"userId" : userId}, // ì„œë²„ë¡œ ì „ì†¡í•  ë°ì´í„°. const id
	    	        success : function(result) { // í†µì‹  ì„±ê³µ ì‹œ ë§¤ê°œë³€ìˆ˜ì— ë°ì´í„° ì €ì¥
	    	            console.log('í†µì‹  ì„±ê³µ ' + result);
	    	            if(result === 'available') {
	    	            	form2.submit();
	    	            } else {

	    	            	const Toast = Swal.mixin({
			                    toast: true,
			                    position: 'center-center',
			                    showConfirmButton: false,
			                    timer: 1500,
			                    timerProgressBar: true,
			                    didOpen: (toast) => {
			                      toast.addEventListener('mouseenter', Swal.stopTimer)
			                      toast.addEventListener('mouseleave', Swal.resumeTimer)
			                    }
			                  })
		
			                  Toast.fire({
			                    icon: 'warning',
			                    title: 'ì´ë¯¸ ë“±ë¡ëœ ì‘ë¬¼ì…ë‹ˆë‹¤.'
			                  })
	    	            	
	    	                false;
	    	            }
	    	        },
	    	        error : function(status, error) {
	    	            console.log('í†µì‹  ì‹¤íŒ¨');
	    	            console.log(status, error);
	    	        }
	    	  })
      })
      
      // ìˆ˜ì • ë²„íŠ¼
      modalModBtn.on('click', function(e) {
    	  
    	  if(modalMiddlecatagori.val() == '' || modalName.val() == '') {
	    		  const Toast = Swal.mixin({
	                    toast: true,
	                    position: 'center-center',
	                    showConfirmButton: false,
	                    timer: 2000,
	                    timerProgressBar: true,
	                    didOpen: (toast) => {
	                      toast.addEventListener('mouseenter', Swal.stopTimer)
	                      toast.addEventListener('mouseleave', Swal.resumeTimer)
	                    }
	                  })

	                  Toast.fire({
	                    icon: 'info',
	                    title: 'ì…ë ¥ê°’ì„ ëª¨ë‘ ì ì–´ì£¼ì„¸ìš”.'
	                  })
	                return false;
      	  } else {
    	  	form1.submit();
      	  }
      })
  })
  
  // ëª¨ë‹¬
  function updateForm() {
	  console.log('updateForm');
	  $('#myModal').modal("show");
  }
  
  // ë“±ë¡ ëª¨ë‹¬
  $('#button').on("click", function() {
  	console.log('c');
  	$('#myModal2').modal("show");
  })
  
  // ìˆ˜ì • ì‹œ ê°’ ì²˜ë¦¬
  function changeSelect() {
  	$("#middlecatagori").val("");
  	
  	var selectvalue = "";
  	selectvalue = $('#flag').val();
  	
  	$("#middlecatagori").val(selectvalue);
  }
  </script>
  
  
</div>