<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/layoutMagement}">

<head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
  <meta charset="UTF-8">
  <style type="text/css">
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    /* Firefox  */
    input[type='number'] {
      -moz-appearance: textfield;
    }

    .left-box {
      float: left;
      width: 50%;
    }

    .right-box {
      float: right;
      width: 50%;
    }

    .form-group {
      width: 350px !important;
    }
    
    .form-control{
      font-size: 13px;
	  color: #222222;
	  width: 320px;
	  border: none;
	  border-bottom: solid #aaaaaa 1px;
	  padding-left: 10px;
	  position: relative;
	  background: none;
	  z-index: 5;
     }
     
    .table-td {
      text-align:center;
      font-weight:bold;
    }
  </style>
</head>
</th:block>
<th:block layout:fragment="script">
</th:block>
<div layout:fragment="contentMagement">
  <!-- page content -->
  <div class="right_col" role="main">
    <div class="">
      <div class="page-title">
        <div class="title_left">
        </div>

      </div>

      <div class="clearfix"></div>

      <div class="row" style="display: block;">

        <div class="clearfix"></div>

        <div class="col-md-12 col-sm-12  ">
        <h3 style="text-align:left"><b>‚Äçüì¶ Ï∞ΩÍ≥† Í¥ÄÎ¶¨</b></h3>
          <div class="x_panel">
            <div class="x_title">
              <ul class="nav navbar-right panel_toolbox">
                    <button type="button" id="button" class="btn btn-primary antosubmit" style="float:right; padding: 8px 20px;background-color:#2A3F54;border: none;"><b>Îì±Î°ù</b></button>
              </ul>
              <div class="clearfix"></div>
            </div>

            <div class="x_content">

              <div class="table-responsive">
                <table class="table table-striped jambo_table bulk_action">
                  <thead>
                    <tr class="headings">
                      <th>
                        <input type="checkbox" id="check-all" class="flat">
                      </th>
                      <th class="column-title table-td">No. </th>
                      <th class="column-title table-td">Ï∞ΩÍ≥† Ïù¥Î¶Ñ </th>
                      <th class="column-title table-td">Îì±Î°ùÏùºÏûê </th>
                      <th class="bulk-actions" colspan="7">
                        <a class="antoo" style="color:#fff; font-weight:500;">Bulk Actions ( <span class="action-cnt">
                          </span> ) <i class="fa fa-chevron-down"></i></a>
                      </th>
                    </tr>
                  </thead>

                  <tbody class="warehouse">
                    <tr class="even pointer" th:each="warehouseList : ${warehouseList }" th:onclick="updateForm()">
                      <td class="a-center ">
                        <input type="checkbox" class="flat" name="table_records">
                      </td>
                      
                      <td class="table-td " th:text="${warehouseList.rn}"></td>
                      <td class="table-td " th:text="${warehouseList.warehouseName}"></td>
                      <td class="table-td " th:text="${#dates.format(warehouseList.registDate,'yyyy-MM-dd')}"></td>
					  
					  <td th:text="${warehouseList.userId}" style="display:none"/>
                      <td th:text="${warehouseList.warehouseCode}" style="display:none"/>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- /page content -->
  <!-- insert modal 1 -->
  <div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
    <div class="modal-dialog modal-lg" style="width:600px;">
      <form name="form1" th:role="form" th:action="@{warehouseList}" method="POST">
		<div class="modal-content" style="border: none;">
        <div class="modal-header" style="display: flex; align-items: center; justify-content: space-between; width:100%;height:50px; background-color: #2A3F54;">
          <h5 class="modal-title" id="myModalLabel" style="color:white; font-weight: bold;">üì¶ Ï∞ΩÍ≥† ÏàòÏ†ï</h5>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"style="color:white;">√ó</button>
        </div>
        <div class="modal-body">
          <input class="form-control" name="userId" value="" type="hidden"/>
          <input class="form-control" name="warehouseCode" value="" type="hidden"/>
            <div style="float:left; margin-right: 100px;" >
          	  <label style="color:black; margin-left: 5px; font-size: 14px; font-weight: bold;">Ï∞ΩÍ≥† Ïù¥Î¶Ñ</label>
              <input class="form-control" name="warehouseName" id="warehouseName" value="" placeholder="" style="width: 490px;">
            </div>
        </div>
        <div class="modal-footer" style="display: flex; align-items: center; justify-content: flex-end; width:100%;height:50px; background-color: #2A3F54;">
          <button id="modalModBtn" type="button" class="btn btn-warning" style="border: none; font-weight: bold; color:white; background: #035785; height: 30px;">ÏàòÏ†ï</button>
          <button id="modalRemoveBtn" type="button" class="btn btn-danger" style="border: none; font-weight: bold; color:white; background: #035785; height: 30px;">ÏÇ≠Ï†ú</button>
        </div>
      </div>
    </form>
    </div>
  </div>
  <!-- /insert modal -->
  <!-- insert modal 2 -->
  <div id="myModal2" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
    <div class="modal-dialog modal-lg" style="width:600px;">
      <form name="form2" th:role="form" th:action="@{warehouseAdd}" method="POST">
      <div class="modal-content" style="border: none;">
        <div class="modal-header" style="display: flex; align-items: center; justify-content: space-between; width:100%;height:50px; background-color: #2A3F54;">
          <h5 class="modal-title" id="myModalLabel" style="color:white; font-weight: bold;">üì¶ Ï∞ΩÍ≥† Îì±Î°ù</h5>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"style="color:white;">√ó</button>
        </div>
        <div class="modal-body">
          <input class="form-control" type="hidden" name="userId" id="userId" th:value="${session.login.userId}" />
            <div style="float:left; margin-right: 100px;" >
          	  <label style="font-weight: bold"><span style="color:red; font-size: 15px;">‚úî</span><span style="color:black; margin-left: 5px; font-size: 14px;">Ï∞ΩÍ≥† Ïù¥Î¶Ñ</span></label>
              <input class="form-control" name="warehouseName" id="warehouseName2" value="" placeholder="ÌïÑÏàò ÏûÖÎ†•" style="width: 490px;">
            </div>
        </div>
        <div class="modal-footer" style="display: flex; align-items: center; justify-content: flex-end; width:100%;height:50px; background-color: #2A3F54;">
          <button id="modalAddBtn" type="button" class="btn btn-warning" style="border: none; font-weight: bold; color:white; background: #035785; height: 30px;">Îì± Î°ù</button>
        </div>
      </div>
    </form>
    </div>
  </div>
  <!-- /insert modal -->

  <script>
  $(document).ready(function(){
	  var modal = $("#myModal");

      // ÏûÖÎ†•Í∞í Ï≤òÎ¶¨
      var modalWarehouseName = modal.find('#warehouseName');
	  var modalUserId = modal.find('input[name="userId"]');
	  var modalWarehouseCode = modal.find('input[name="warehouseCode"]'); // ÏÇ≠Ï†úÏö©(ÏóÖÎç∞Ïù¥Ìä∏)
      
   	  // Î≤ÑÌäº Ï≤òÎ¶¨
      var modalModBtn = $("#modalModBtn");
      var modalRemoveBtn = $("#modalRemoveBtn");
      var modalAddBtn = $("#modalAddBtn");
      
      // ÌÅ¥Î¶≠ Ïãú Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
      $('.warehouse').on('click', 'tr', function (e) {
    	console.log($(this)[0]);
    	let tr = $(this)[0];
    	
    	modalWarehouseName.val($(this)[0].children[2].textContent);
    	modalUserId.val($(this)[0].children[4].textContent);
    	modalWarehouseCode.val($(this)[0].children[5].textContent); // ÏÇ≠Ï†úÏö©(ÏóÖÎç∞Ïù¥Ìä∏)
		
		// ÏÇ≠Ï†ú Î≤ÑÌäº
		modalRemoveBtn.on('click', function() {
			let warehouseCode = modalWarehouseCode.val();
            
			Swal.fire({
	               title: 'ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
	               text: "Îã§Ïãú ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§. Ïã†Ï§ëÌïòÏÑ∏Ïöî.",
	               icon: 'warning',
	               showCancelButton: true,
	               confirmButtonColor: '#3085d6',
	               cancelButtonColor: '#d33',
	               confirmButtonText: 'ÏÇ≠Ï†ú',
	               cancelButtonText: 'Ï∑®ÏÜå'
	           }).then((result) => {
	               if (result.isConfirmed) {
	                   
	                   $.ajax({
	                       type : 'get',
	                       url : "/ohnong/warehouseDelete/" + warehouseCode,
	                       dataType : 'text',
	                       success : function(data) {
	                           console.log(data);
	                           if(data == 'success') {
	                           const Toast = Swal.mixin({
	                               toast: true,
	                               position: 'center-center',
	                               showConfirmButton: false,
	                               timer: 2000,
	                               timerProgressBar: true,
	                               didOpen: (toast) => {
	                                 toast.addEventListener('mouseenter', Swal.stopTimer)
	                                 toast.addEventListener('mouseleave', Swal.resumeTimer)
	                               }
	                             })
	                             Toast.fire({
	                               icon: 'success',
	                               title: 'ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.'
	                             })
	                           } else if(data = 'fail') {
	                               alert("Îã§Ïãú ÏãúÎèÑ Î∞îÎûçÎãàÎã§.")
	                           }
	                       },
	                       error : function(status, error) {
	                           console.log(status, error);
	                       }
	                   })
	                   
	                   setTimeout("location.reload()", 2000);
	                   Swal.fire(
	                       'ÏÇ≠Ï†úÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.',
	                       'success'
	                   )
	               }
	           })
        }) // ÏÇ≠Ï†ú ÎÅù
        
      })
      
      // Îì±Î°ù Î≤ÑÌäº
      modalAddBtn.on('click', function() {
    	  var warehouseName = $('#warehouseName2').val();
    	  var userId = $('#userId').val();
    	  
    	  if($('#warehouseName2').val() == '') {
    		  const Toast = Swal.mixin({
                  toast: true,
                  position: 'center-center',
                  showConfirmButton: false,
                  timer: 2000,
                  timerProgressBar: true,
                  didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                  }
                })

                Toast.fire({
                  icon: 'info',
                  title: 'ÏûÖÎ†•Í∞íÏùÑ Î™®Îëê Ï†ÅÏñ¥Ï£ºÏÑ∏Ïöî.'
                })

              return false;
      	  }
    	  
      		// Ï§ëÎ≥µ Í≤ÄÏÇ¨
	    	  $.ajax({
	    	        type : 'get',
	    	        url : '/ohnong/checkWarehouse', // ÏÑúÎ≤Ñ ÏöîÏ≤≠ url
	    	        dataType : 'text', // ÏÑúÎ≤ÑÎ°úÎ∂ÄÌÑ∞ ÏùëÎãµÎ∞õÏùÑ Îç∞Ïù¥ÌÑ∞ ÌòïÌÉú 
	    	        data : {"warehouseName" : warehouseName,
	    	        		"userId" : userId}, // ÏÑúÎ≤ÑÎ°ú Ï†ÑÏÜ°Ìï† Îç∞Ïù¥ÌÑ∞. const id
	    	        success : function(result) { // ÌÜµÏã† ÏÑ±Í≥µ Ïãú Îß§Í∞úÎ≥ÄÏàòÏóê Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
	    	            console.log('ÌÜµÏã† ÏÑ±Í≥µ ' + result);
	    	            if(result === 'available') {
	    	            	form2.submit();
	    	            } else {

	    	            	const Toast = Swal.mixin({
			                    toast: true,
			                    position: 'center-center',
			                    showConfirmButton: false,
			                    timer: 1500,
			                    timerProgressBar: true,
			                    didOpen: (toast) => {
			                      toast.addEventListener('mouseenter', Swal.stopTimer)
			                      toast.addEventListener('mouseleave', Swal.resumeTimer)
			                    }
			                  })
		
			                  Toast.fire({
			                    icon: 'warning',
			                    title: 'Ïù¥ÎØ∏ Îì±Î°ùÎêú Ï∞ΩÍ≥†ÏûÖÎãàÎã§.'
			                  })
	    	            	
	    	                false;
	    	            }
	    	        },
	    	        error : function(status, error) {
	    	            console.log('ÌÜµÏã† Ïã§Ìå®');
	    	            console.log(status, error);
	    	        }
	    	  })
      })
      
      // ÏàòÏ†ï Î≤ÑÌäº
      modalModBtn.on('click', function(e) {
    	  
    	  if(modalWarehouseName.val() == '') {
	    		  const Toast = Swal.mixin({
	                    toast: true,
	                    position: 'center-center',
	                    showConfirmButton: false,
	                    timer: 2000,
	                    timerProgressBar: true,
	                    didOpen: (toast) => {
	                      toast.addEventListener('mouseenter', Swal.stopTimer)
	                      toast.addEventListener('mouseleave', Swal.resumeTimer)
	                    }
	                  })

	                  Toast.fire({
	                    icon: 'info',
	                    title: 'ÏûÖÎ†•Í∞íÏùÑ Î™®Îëê Ï†ÅÏñ¥Ï£ºÏÑ∏Ïöî.'
	                  })
	                return false;
      	  } else {
    	  	form1.submit();
      	  }
      })
      
  })
  
  // Î™®Îã¨
  function updateForm() {
	  console.log('updateForm');
	  $('#myModal').modal("show");
  }
  
  //Îì±Î°ù Î≤ÑÌäº
  $('#button').on("click", function() {
  	console.log('c');
  	$('#myModal2').modal("show");
  })
  </script>
  
  
</div>