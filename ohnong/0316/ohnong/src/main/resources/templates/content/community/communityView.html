<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layoutMagement}">

<head>
 <title> oh-nong!</title>
 
<meta charset="UTF-8">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.css" />
<link rel="stylesheet"
	href="https://uicdn.toast.com/editor/2.0.0/toastui-editor.min.css" />
<link rel="stylesheet"
	href="https://uicdn.toast.com/editor/latest/toastui-editor-viewer.min.css" />
<!-- TOAST UI Editor CDN(JS) -->
<script
	src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<!-- TOAST UI Editor CDN(CSS) -->
<link rel="stylesheet"
	href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
<script src="https://uicdn.toast.com/editor/latest/i18n/ko-kr.min.js"></script>
<link rel="stylesheet" th:href="@{/css/default.css}" />
<link rel="stylesheet" th:href="@{/css/content.css}" />
<link rel="stylesheet" th:href="@{/css/button.css}" />
<style>
#deleteBtn:hover {
	color: red;
}

#mainb {
	height: 550px;
	overflow: auto;
}

#mainb::-webkit-scrollbar {
	width: 5px; /*ìŠ¤í¬ë¡¤ë°”ì˜ ë„ˆë¹„*/
}

#mainb::-webkit-scrollbar-thumb {
	background-color: grey; /*ìŠ¤í¬ë¡¤ë°”ì˜ ìƒ‰ìƒ*/
}

#mainb::-webkit-scrollbar-track {
	background-color: beige; /*ìŠ¤í¬ë¡¤ë°” íŠ¸ë™ ìƒ‰ìƒ*/
}

.m_head {
	height: 15%;
	padding: 10px;
	display: flex;
	justify-content: space-between;
	background-color: #2A3F54;
	border-top-left-radius: 10px;
	border-top-right-radius: 10px;
	color: white;
}

.m_body {
	height: 70%;
	padding: 20px;
	background-color: #F4F4F4;
}

.m_footer {
	height: 15%;
	padding: 10px;
	background-color: #2A3F54;
	border-bottom-left-radius: 10px;
	border-bottom-right-radius: 10px;
	display: flex;
	justify-content: end;
}

.modal_title {
	font-size: 18px;
	color: gray;
	font-weight: 500;
}

.modal_label {
	padding: 2px 0px 2px 0px;
	background-color: skyblue;
	width: 80px;
	border-top: 2px solid black;
	border-bottom: 2px solid black;
	text-align: center;
	color: black;
	margin-top: 10px;
	font-weight: bolder;
}

.alertTitle {
	font-weight: bold;
	font-size: 20px;
}

.alertMessage {
	font-weight: bold;
	font-size: 20px;
}
</style>


</head>

<body class="nav-md">
	<div layout:fragment="contentMagement">
		<!-- page content -->
		<div class="right_col" role="main">
			<div class="">
				<!-- ì „ì²´ ë‚´ìš© -->
				<div class="page-title">
					<!-- ì œëª© -->
					<div class="title_left">
						<h3>Oh! Nong</h3>
					</div>
				</div>
				<div class="row" style="display: block;">
					<div class="col-md-12 ">
						<div class="x_panel">
							<div class="x_title">
								<!-- ì œëª© -->
								<h2 class="green">
									ê¸€ ë²ˆí˜¸ : <span th:text="${board.boardBno}"></span>
									<span th:if="${board.exist == 5}">(ì„¸ë²ˆ ì´ìƒ ì‹ ê³ ë°›ì•„ ë¸”ë¼ì¸ë“œì²˜ë¦¬ëœ ê¸€ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ìœ ì €ì—ê²Œ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë³µêµ¬ë¥¼ ì›í•˜ì‹œë©´ 1:1 ë¬¸ì˜ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”) </span>		
								</h2>
								
								<ul class="nav navbar-right panel_toolbox">
									<li><a class="collapse-link"><i
											class="fa fa-chevron-up"></i></a></li>
									<li class="dropdown"><a href="#" class="dropdown-toggle"
										data-toggle="dropdown" role="button" aria-expanded="false"><i
											class="fa fa-wrench"></i></a>
										<div class="dropdown-menu">
											<a class="dropdown-item" href="#">ê³µì§€ì‚¬í•­</a> <a
												class="dropdown-item" href="#">ì˜¤ë†ì‹</a> <a
												class="dropdown-item" href="#">ì˜¤ì‹œëŠ”ê¸¸</a>
										</div></li>
								</ul>
								<div class="clearfix"></div>
							</div>
							<div class="x_content">
								<table class="tb tb_row" style="border: 1px solid black;">
									<colgroup>
										<col style="width: 15%;" />
										<col style="width: 35%;" />
										<col style="width: 15%;" />
										<col style="width: 35%;" />
									</colgroup>

									<tbody>
										<tr>
											<th>ì œëª©</th>
											<td><span 
												th:text="${board.boardTitle}"></span></td>
											<th scope="row">ì¡°íšŒìˆ˜</th>
											<td><span 
												th:text="${board.boardHitcount}"></span></td>
										</tr>
										<tr>
											<th scope="row">ë“±ë¡ì¼</th>
											<td><span 
												th:text="${#dates.format(board.boardRegdate, 'yyyy-MM-dd')}"></span>
												<span 
												th:if="${board.boardRegdate != board.boardUploaddate}" th:text="'/ ìˆ˜ì •ë‚ ì§œ : '+${#dates.format(board.boardUploaddate, 'yyyy-MM-dd')}"></span></td>
											<th scope="row">ì¹´í…Œê³ ë¦¬</th>
											<td><span th:switch="${board.boardCategory}"> <span
													th:case="A">ë…¸í•˜ìš°&íŒ</span> <span th:case="B">1:1ë¬¸ì˜</span> <span
													th:case="C">ì „ë¬¸ì¸ì—ê²Œ ë¬¼ì–´ë³´ì„¸ìš”</span> <span th:case="D">ì¡ë‹´</span>
											</span></td>
										</tr>
										<tr>
											<th>ì‘ì„±ì</th>
											<td colspan="3"><span 
												th:text="${board.userId}"></span></td>
										</tr>
										<tr>
											<th>ë‚´ìš©</th>
											<td colspan="4" style="height: 500px;">
												<div id="viewer" style="height: 500px;"></div> <textarea
													spellcheck="false" id="viewers"
													style="display: none; height: 800px">[[${board.boardContent}]]</textarea>
											</td>
										</tr>
									</tbody>
								</table>
								<!-- ë‚´ìš© -->
								<!--                 ì¶”ì²œë²„íŠ¼            -->
								<div
									style="display: flex; justify-content: center; margin: 25px">

									<!--ë¡œê·¸ì¸ + ìì‹ ì˜ ê¸€ì¸ ê²½ìš°. -->
									<a
										th:if="${session.login != null} AND (${session.login?.userId}==${board.userId})"
										class="btn btn-app" th:onclick="myBoard()" id="likeButton">
										<span style="width: 25px; height: 25px; font-size: 13px;"
										class="badge bg-blue" id="likeCount">[[${board.boardLike}]]
									</span> <i class="fa fa-heart-o"></i>ì¶”ì²œ
									</a>
									<!-- ë¡œê·¸ì¸ + ìì‹ ì˜ ê¸€ì´ ì•„ë‹Œ ê²½ìš° -->
									<a
										th:if="${session.login != null} AND (${session.login?.userId} !=${board.userId})"
										class="btn btn-app" th:onclick="updateLike()" id="likeButton">
										<span style="width: 25px; height: 25px; font-size: 13px;"
										class="badge bg-blue" id="likeCount">[[${board.boardLike}]]
									</span> <i class="fa fa-heart-o"></i>ì¶”ì²œ
									</a>
									<!-- ë¡œê·¸ì¸ ì•ˆí•œ ìœ ì € -->
									<a th:if="${session.login == null}" class="btn btn-app"
										th:onclick="notUser()" id="likeButton"> <span
										style="width: 25px; height: 25px; font-size: 13px;"
										class="badge bg-blue" id="likeCount">[[${board.boardLike}]]
									</span> <i class="fa fa-heart-o"></i>ì¶”ì²œ
									</a>

									<!--                  ëª©ë¡ìœ¼ë¡œ            -->
									<a  th:if="${#strings.trim(#httpServletRequest.getParameter('col')) == 'A'}" 
										th:href="@{/community(pageNum=${criteria_1.pageNum},amount=10,type=${criteria_1.type},keyword=${criteria_1.keyword},category=${criteria_1.category})}"
										class="btn btn-app"> <i class="fa fa-repeat"></i> ëª©ë¡ìœ¼ë¡œ
									</a>
									
									<a th:if="${#strings.trim(#httpServletRequest.getParameter('col')) == 'B'}" 
										th:href="@{/mywrite(pageNum=${criteria_1.pageNum},amount=10,type=${criteria_1.type},category=${criteria_1.category})}"
										class="btn btn-app"> <i class="fa fa-repeat"></i> ëª©ë¡ìœ¼ë¡œ
									</a>
									<a th:if="${#strings.trim(#httpServletRequest.getParameter('col')) == 'C'}" 
										th:href="@{/myreply(pageNum=${criteria_1.pageNum},amount=10,type=${criteria_1.type},category=${criteria_1.category})}"
										class="btn btn-app"> <i class="fa fa-repeat"></i> ëª©ë¡ìœ¼ë¡œ
									</a>
									<a th:if="${#strings.trim(#httpServletRequest.getParameter('col')) == 'E'}" 
										th:href="@{/communityPro(pageNum=${criteria_1.pageNum},amount=10,type=${criteria_1.type})}"
										class="btn btn-app"> <i class="fa fa-repeat"></i> ëª©ë¡ìœ¼ë¡œ
									</a>
									<a th:if="${#strings.trim(#httpServletRequest.getParameter('col')) == 'F'}" 
										th:href="@{/reportList(pageNum=${criteria_1.pageNum},amount=10)}"
										class="btn btn-app"> <i class="fa fa-repeat"></i> ëª©ë¡ìœ¼ë¡œ
									</a>
									<a th:if="${#strings.trim(#httpServletRequest.getParameter('col')) == 'D'}" 
										th:href="@{/boardLike(pageNum=${criteria_1.pageNum},amount=10,type=${criteria_1.type},category=${criteria_1.category})}"
										class="btn btn-app"> <i class="fa fa-repeat"></i> ëª©ë¡ìœ¼ë¡œ
									</a>
									
										
									<!--   ê¸€ ìˆ˜ì •í˜ì´ì§€ë¡œ ê°€ëŠ”ë²„íŠ¼  -->
									<!-- ìì‹ ì˜ ê¸€ì¸ ê²½ìš° -->
									<a
										th:if="${session.login != null} AND (${session.login?.userId} == ${board.userId})"
										th:href="@{/communityUpdate(boardBno=${board.boardBno}, pageNum=${criteria_1.pageNum},amount=10,type=${criteria_1.type},keyword=${criteria_1.keyword},category=${criteria_1.category},userId=${session.login?.userId})}"
										class="btn btn-app"> <i class="fa fa-edit"></i> ìˆ˜ì •í•˜ê¸°
									</a>
									<!-- ìì‹ ì˜ ê¸€ì´ ì•„ë‹Œ ê²½ìš°... -->
									<span
										th:unless="${session.login != null} AND (${session.login?.userId} eq ${board.userId})"
										style="display: none;"> </span>
									<!-- ì‹ ê³ í•˜ê¸° ë²„íŠ¼ -->

									<a th:if="${session.login != null} AND (${session.login?.userId} !=${board.userId})"
										class="btn btn-app" id="report-btn"> <span
										class="badge bg-red"></span> <i class="fa fa-bullhorn"></i>ì‹ ê³ í•˜ê¸°
									</a>
									<!-- ì‚­ì œë²„íŠ¼ -->
									<a
										th:if="${session.login != null} AND (${session.login?.userId} == ${board.userId})"
										class="btn btn-app" th:onclick="deleteBoard()" id="deleteBtn">
										<span class="glyphicon glyphicon-trash"> </span><i></i>ì‚­ì œ
									</a>
								</div>
								<div style="display: flex; align-items: center; justify-content: center;">
								  <h2 th:if="${board.boardCategory =='C'}">ğŸ“¢ì „ë¬¸ì¸ì—ê²Œ ë¬¼ì–´ë³´ì„¸ìš” ì¹´í…Œê³ ë¦¬ëŠ” ì¶”ì²œìˆ˜ê°€ 10ì´ ë„˜ìœ¼ë©´ ìš´ì˜ìì˜ ì „ë¬¸ì¸ ìë¬¸ ë‹µë³€ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</h2>
								</div>
								<div style="display: flex; align-items: center; justify-content: center;">
								  <h2 th:if="${board.boardCategory =='B'}">ğŸ“¢1:1ë¬¸ì˜ëŠ” ê´€ë¦¬ìë§Œ ëŒ“ê¸€ì„ ë‹¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤</h2>
								</div>

								<!-- ì‹ ê³ í•˜ê¸° ëª¨ë‹¬ì°½ -->
								<div class="modal" id="report-modal">
									<div class="modal_body">

										<div class="m_head">
											<h2 style="color: white;">ğŸš¨ ì‹ ê³ í•˜ê¸°</h2>
											<span class="close" style="color: white;">X</span>
										</div>
										<form>
											<div class="m_body">
												<label class="modal_label" for="report-input"
													style="margin-right: 15px; background-color: #2A3F54; color: white">ì‹ ê³ 
													ìœ í˜•</label> <label><input type="radio" name="report-type"
													value="ìŠ¤íŒ¸"> ìŠ¤íŒ¸</label> <label><input type="radio"
													name="report-type" value="ìš•ì„¤"> ìš•ì„¤</label> <label><input
													type="radio" name="report-type" value="ìŒë€ë¬¼">ìŒë€ë¬¼</label> <br>
												<textarea class="input_box" id="report-input" name="report"
													spellcheck="false"></textarea>
											</div>
											<div class="m_footer">
												<input class="modal_btn save"
													style="width: 80px; height: 30px; padding: 5px; float: left; border-radius: 3px; font-weight: bold;"
													type="submit" value="ì œ ì¶œ">
											</div>
										</form>
									</div>
								</div>

							</div>
						</div>

						<!-- ëŒ“ê¸€ html-->
						<div id="replyHtml"></div>
						<!-- ëŒ“ê¸€ -->
					</div>


<script>

var boardBno2 = "[[${board.boardBno}]]";

//ëŒ“ê¸€listë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜.
function replyload(p){
	
	$('#replyHtml').load("/ohnong/communityReply?boardBno="+boardBno2+"&pageNum="+p);
	
}

	///ë¡œë”© ë˜ìë§ˆì replyHTMLë¶€ë¥´ê¸°
	$(function(){
		
		replyload(1);
		
		likeBeforeCheck();
		
	})
	
	//ìê¸° ê¸€ ì¶”ì²œ ëˆŒë €ì„ë•Œ ì•ŒëŒ
	function myBoard(){
	    Swal.fire({
	        icon: 'warning',
	        text: 'ìì‹ ì˜ ê¸€ì€ ì¶”ì²œ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
	      });
	}
	
	//ë¹„íšŒì›ì´ ì¶”ì²œ ëˆŒë €ì„ë•Œ ì•ŒëŒ
	function notUser(){
	
		 Swal.fire({
		        icon: 'warning',
		        text: 'ë¡œê·¸ì¸ í•œ íšŒì›ë§Œ ì¶”ì²œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
		      });
		
	}
	
	//ì¶”ì²œ í•œ ê¸€ì¸ì§€ ì²´í¬ í›„ ë¯¸ë¦¬ í•˜íŠ¸ì²˜ë¦¬
	let likeBeforeCheck= function(){
		
		 let likeNum='[[${like}]]';
		 
		 if(likeNum == 1){
			 $('#likeButton').attr('style','color:red');
		 }	
		
	}
	
		var reportdiv = $('#report-modal');
		reportdiv.css("position", "absolute");
		reportdiv.css("top", Math.max(0, 4 *(($(window).height() - reportdiv.outerHeight()) / 2) + $(window).scrollTop()) + "px");
		reportdiv.css("left", Math.max(0, 2 * (($(window).width() - reportdiv.outerWidth()) ) + $(window).scrollLeft()) + "px");
		reportdiv.css("width","400px");
		reportdiv.css("text-align","center");
		reportdiv.css("color","black");
		
		$('.close').css("text-align","right");
		
	  // ì‹ ê³ í•˜ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
	  $('#report-btn').on('click', function() {
	    $('#report-modal').css('display', 'block');
	  });

	  // ëª¨ë‹¬ì°½ ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
	  $('.close').on('click', function() {
	    $('#report-modal').css('display', 'none');
	    $('#report-input').val('');
	  });

	  // ëª¨ë‹¬ì°½ ì™¸ë¶€ í´ë¦­ ì‹œ ëª¨ë‹¬ì°½ ë‹«ê¸°
	  $(window).on('click', function(event) {
	    if (event.target == $('#report-modal')[0]) {
	      $('#report-modal').css('display', 'none');
	      $('#report-input').val('');
	    }
	  });

	  
	  
	  
	  // ì‹ ê³ í•˜ê¸° í¼ ì œì¶œ ì´ë²¤íŠ¸
	  $('#report-modal form').on('submit', function(event) {
	    
		  event.preventDefault(); // ê¸°ë³¸ ì´ë²¤íŠ¸ ë™ì‘ ì¤‘ì§€

	    var reportType = $('input[name="report-type"]:checked').val(); // ì„ íƒëœ ì‹ ê³  ìœ í˜•
	    var reportContent = $('#report-input').val(); // ì…ë ¥ëœ ì‹ ê³  ë‚´ìš©
	    
	    
	    if($('input[name="report-type"]').is(':checked') == false){
	  
	       Swal.fire({
		      icon: 'warning',
		      text: "ì‹ ê³  ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”",
		    });
	        return false;
	    }
	    
	    if($('#report-input').val().length == 0){
	    	 Swal.fire({
			      icon: 'warning',
			      text: "ì‹ ê³  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”",
			    });
	    	return false;
	    }
	    
		 $.ajax({
			 
			 url: "/ohnong/reportWrite",
			 data:{
				 "boardBno" : boardBno2,
				 "reportType": reportType,
				 "reportContent":reportContent,
				 "userId": '[[${session.login?.userId}]]'
			 },
			 type:"post",
			 success:function(result){
               
				 Swal.fire({
	                icon: 'success',          
	                title: 'ğŸš¨ì‹ ê³  ì²˜ë¦¬ ê²°ê³¼ğŸš¨\n\n ì‹ ê³  ìœ í˜• : '+reportType ,     
	                text: '\n '+'"' + reportContent+'"' +" "+'\n ë‚´ìš©ìœ¼ë¡œ ì‹ ê³ ì ‘ìˆ˜ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'
	            });
	            
	            
	
	            // ëª¨ë‹¬ì°½ ë‹«ê¸°
	            $('#report-modal').css('display', 'none');
	
	            $('#report-input').val('');  
					
				 							 					 
			 },
			 error:function(){
				 
				 Swal.fire({
		                icon: 'error',              
		                text: 'ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n ìš´ì˜ìì—ê²Œ ë¬¸ì˜ì£¼ì„¸ì—ìš”.'
		            });
					
			 }
		
		 })
						   
	});
				
				  
				
				
////////////////////ì¶”ì²œê¸°ëŠ¥
function updateLike(){
//ë‚˜ì¤‘ì— ë¡œê·¸ì¸í•œ userIdë°›ì•„ì™€ì•¼í•¨.>ì¶”ê°€í•¨.
			
	var boardBno2 = '[[${board.boardBno}]]';
	let oldCountNum = parseInt($('#likeCount').text());
	let plusCount = String(oldCountNum+1);
	let minCount = String(oldCountNum-1);
	
	$.ajax({
		
		url: "/ohnong/updateLike",
		type:"POST",
		data:{
			"boardBno": boardBno2,
			"userId":'[[${session.login?.userId}]]'							
		}
		,success:function(likeCheck){
			
			if(likeCheck == 0){
				
				$('#likeCount').text(plusCount);
				$('#likeButton').attr('style','color:red');
			
			}else if(likeCheck == 1){
				$('#likeCount').text(minCount);
				$('#likeButton').attr('style','');
			}
		}
		,error:function(){
			 
			 Swal.fire({
	                icon: 'error',              
	                text: 'ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n ìš´ì˜ìì—ê²Œ ë¬¸ì˜ì£¼ì„¸ì—ìš”.'
	            });
		}			
	})
				
}
				 ////////////

  ///////ì—ë””í„° ë·°ì–´.
function bodyinit() {

	if (toastui === undefined) {
		return;
	}
	var viewer = new toastui.Editor.factory({
		el : document.querySelector('#viewer'),
		initialValue : document.querySelector("#viewers").value,
		viewer : true,
		initialEditType : "wysiwyg"
	})
};

bodyinit();
				
 //ê¸€ì‚­ì œ
function deleteBoard(){
	
	 Swal.fire({
	      title: 'ì •ë§ ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
	      text: "ë‹¤ì‹œ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹ ì¤‘í•˜ì„¸ìš”.",
	      icon: 'warning',
	      showCancelButton: true,
	      confirmButtonColor: '#3085d6',
	      cancelButtonColor: '#d33',
	      confirmButtonText: 'ìŠ¹ì¸',
	      cancelButtonText: 'ì·¨ì†Œ',
	      reverseButtons: true, // ë²„íŠ¼ ìˆœì„œ ê±°ê¾¸ë¡œ
	      
	    }).then((result) => {
	      if (result.isConfirmed) {
	    	  
	    	  $.ajax({
	    			 
	    			 url: "/ohnong/deleteBoard",
	    			 data:{
	    				 "boardBno" : boardBno2
	    			 },
	    			 type:"post",
	    			 success:function(result){
	    					    				
	    				Swal.fire('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.')
	    				setTimeout(function(){window.location="/ohnong/community?pageNum="+[[${criteria_1.pageNum}]], 4000);
	    				 							 					 
	    			 },
	    			 error:function(){
	    				 
	    				 Swal.fire('ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
	    			 }
	    		 })//ajax   
	        }
	    })
	
	
 }
 	
</script>
				</div>
			</div>
		</div>
	</div>

</body>
</html>
